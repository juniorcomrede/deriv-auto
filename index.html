<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Test Mini Store ‚Äî Telegram Order Demo</title>
  <style>
    :root{--accent:#ff5a5f;--muted:#666;--card:#fff}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial; margin:0; background:#f6f7fb; color:#111}
    .container{max-width:520px;margin:28px auto;padding:18px}
    .card{background:var(--card);border-radius:14px;padding:18px;box-shadow:0 6px 18px rgba(20,20,50,0.06)}
    .hero{display:flex;gap:16px}
    img.prod{width:150px;height:150px;object-fit:cover;border-radius:10px}
    h1{font-size:18px;margin:0}
    .price{font-weight:700;color:var(--accent);font-size:20px}
    .mrp{color:var(--muted);text-decoration:line-through;margin-left:8px;font-weight:500}
    .badge{display:inline-block;background:#fff;border-radius:8px;padding:6px 10px;margin-top:8px;font-size:13px;box-shadow:0 3px 8px rgba(20,20,50,0.04)}
    form{margin-top:14px}
    input, textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e7ee;margin-top:8px;font-size:15px;box-sizing:border-box}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    button.cta{background:var(--accent);color:#fff;border:none;padding:12px 16px;border-radius:10px;font-size:16px;margin-top:12px;width:100%}
    .meta{display:flex;justify-content:space-between;align-items:center;margin-top:12px;color:var(--muted);font-size:13px}
    .small{font-size:13px;color:var(--muted);margin-top:6px}
    .notice{background:#fff8f4;border-left:4px solid #ffd1b3;padding:10px;border-radius:8px;margin-top:12px}
    .preview{white-space:pre-wrap;background:#f3f4f8;padding:12px;border-radius:8px;margin-top:12px}
    .success{background:#ecffef;border-left:4px solid #b9f0c6;padding:10px;border-radius:8px;margin-top:12px}
    .danger{background:#ffeeee;border-left:4px solid #ffb3b3;padding:10px;border-radius:8px;margin-top:12px}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="hero">
        <img class="prod" src="https://via.placeholder.com/300x300.png?text=Test+Combo" alt="product">
        <div>
          <h1 id="product-name">Aloe Vera Face Cream Combo (Test)</h1>
          <div style="margin-top:8px">
            <span class="price">‚Çπ<span id="sale-price">249</span></span>
            <span class="mrp">‚Çπ<span id="mrp">999</span></span>
          </div>
          <div class="badge">COD Available ‚Ä¢ Free Delivery</div>
          <div class="small" id="stock-text">Only <strong id="stock-count">12</strong> left at this price</div>
          <div class="small" id="countdown">Deal ends in <strong id="timer">03:00:00</strong></div>
        </div>
      </div>

      <form id="order-form" onsubmit="event.preventDefault();handleSubmit();">
        <input type="text" id="name" placeholder="Your name (for delivery)" required />
        <input type="tel" id="phone" placeholder="Phone number (WhatsApp/Call)" required />
        <textarea id="address" placeholder="Full delivery address (house, street, city, pincode)" rows="3" required></textarea>

        <div class="row" style="margin-top:8px">
          <select id="payment">
            <option value="COD">Cash on Delivery (COD)</option>
            <option value="Prepaid">Prepaid (not implemented in test)</option>
          </select>
          <input type="number" id="qty" value="1" min="1" placeholder="Qty" />
        </div>

        <button class="cta" type="submit">üî• ORDER NOW (Test Mode)</button>

        <div class="meta">
          <div id="test-mode-note" style="color:#333;font-weight:600">TEST MODE: ON</div>
          <div style="font-size:13px;color:var(--muted)">Prototype ‚Ä¢ No payment collected</div>
        </div>

        <div id="message-area"></div>
      </form>
    </div>

    <p style="text-align:center;margin-top:12px;color:var(--muted)">This is a <strong>test</strong> demo page for your GitHub Pages ‚Üí Telegram bot flow.</p>
    <div class="card" style="margin-top:12px">
      <h3 style="margin:0">Developer Notes</h3>
      <div class="small" style="margin-top:8px">
        - This page runs in <strong>TEST MODE</strong> by default (no external calls).<br>
        - To enable real Telegram notifications: edit <code>TEST_MODE</code>, set <code>BOT_TOKEN</code> & <code>CHAT_ID</code> in the JS below. (Not recommended for public pages without a server proxy.)
      </div>
    </div>
  </div>

<script>
/* ===== CONFIG - edit only for a real test (NOT RECOMMENDED on public pages) ===== */
const TEST_MODE = true;   // true = show preview only; false = attempt to send to Telegram
const BOT_TOKEN = 'REPLACE_WITH_BOT_TOKEN'; // e.g. 123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
const CHAT_ID = 'REPLACE_WITH_CHAT_ID';     // your Telegram chat id
/* ============================================================================ */

let stock = 12;
const salePrice = 249;
const mrp = 999;
const productName = document.getElementById('product-name').innerText;

document.getElementById('sale-price').innerText = salePrice;
document.getElementById('mrp').innerText = mrp;
document.getElementById('stock-count').innerText = stock;

// Simple countdown timer (starts at 3 hours)
let secondsLeft = 3 * 60 * 60;
function tick() {
  if(secondsLeft <= 0) { document.getElementById('timer').innerText = "00:00:00"; return; }
  secondsLeft--;
  const h = String(Math.floor(secondsLeft / 3600)).padStart(2,'0');
  const m = String(Math.floor((secondsLeft % 3600) / 60)).padStart(2,'0');
  const s = String(secondsLeft % 60).padStart(2,'0');
  document.getElementById('timer').innerText = h+':'+m+':'+s;
}
setInterval(tick,1000);

// Helper: show messages in page
function showMessage(html, cls='preview') {
  const area = document.getElementById('message-area');
  area.innerHTML = '<div class="'+cls+'">'+html+'</div>';
}

// Handle form submit
function handleSubmit(){
  const name = document.getElementById('name').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const address = document.getElementById('address').value.trim();
  const payment = document.getElementById('payment').value;
  const qty = parseInt(document.getElementById('qty').value) || 1;

  if(!name || !phone || !address){ showMessage('Please fill all fields.', 'danger'); return; }
  if(stock <= 0){ showMessage('Sorry, item is out of stock at this price.', 'danger'); return; }

  const total = salePrice * qty;
  const messageText = `üì¶ New Test Order!\nüë§ Name: ${name}\nüìû Phone: ${phone}\nüìç Address: ${address}\nüí∞ Payment: ${payment}\nüõí Product: ${productName}\nüî¢ Qty: ${qty}\nüíµ Total: ‚Çπ${total}`;

  if(TEST_MODE){
    showMessage('<strong>Order preview (TEST MODE)</strong>\n\n'+messageText, 'preview');
    // simulate stock decrement for test
    stock = Math.max(0, stock - 1);
    document.getElementById('stock-count').innerText = stock;
    // show confirmation box
    setTimeout(()=> showMessage('‚úÖ Order placed (simulated). You will receive the order details in Telegram when TEST_MODE=false.', 'success'), 800);
    return;
  }

  // REAL MODE: attempt to send to Telegram (note: exposing BOT_TOKEN in client side is insecure for production)
  const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
  const payload = {
    chat_id: CHAT_ID,
    text: messageText
  };

  // Try POST JSON first (may fail due to CORS on some browsers)
  fetch(url, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(payload)
  })
  .then(r => r.json())
  .then(data => {
    if(data && data.ok){
      showMessage('‚úÖ Order sent to Telegram. Place the Meesho order now. (Manual fulfillment)', 'success');
      stock = Math.max(0, stock - 1);
      document.getElementById('stock-count').innerText = stock;
    } else {
      showMessage('Telegram API responded but did not confirm sending. Response: ' + JSON.stringify(data), 'danger');
    }
  })
  .catch(err => {
    // Fallback: open GET link (may also expose token in URL)
    const q = encodeURIComponent(messageText);
    const getUrl = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${q}`;
    window.open(getUrl, '_blank');
    showMessage('‚ö†Ô∏è POST failed (possible CORS). A GET window was opened as fallback. If that succeeded, check Telegram. Otherwise use a server-side proxy for reliability.', 'notice');
    console.error(err);
  });
}
</script>
</body>
</html>